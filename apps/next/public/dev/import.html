<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <title>Quizfuze Flashcard Importer</title>
    <style>
        /* Add a bit of custom style for loading animation */
        .loading {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ffffff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="bg-white shadow-md rounded-lg p-6 w-full max-w-md">
        <h2 class="text-xl font-semibold text-center mb-4">Quizfuze Import Flashcards</h2>

        <div class="mb-4">
            <input type="file" id="fileInput"
                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 cursor-pointer"
                accept=".json" />
        </div>

        <div class="mb-4">
            <label for="importPassword" class="block text-sm font-medium text-gray-700 mb-1">Import Password</label>
            <input type="password" id="importPassword"
                class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                required />
        </div>

        <button id="importButton"
            class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring focus:ring-blue-300 disabled:opacity-50"
            disabled>Import Flashcards</button>

        <div id="loading" class="hidden mt-4 flex items-center justify-center">
            <div class="loading mr-2"></div>
            <span>Importing...</span>
        </div>

        <div id="log" class="mt-4 text-sm text-gray-700"></div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const importButton = document.getElementById('importButton');
        const importPasswordInput = document.getElementById('importPassword');
        const logDiv = document.getElementById('log');
        const loadingDiv = document.getElementById('loading');

        // Enable the import button only if a file is selected
        fileInput.addEventListener('change', function () {
            importButton.disabled = !fileInput.files.length || !importPasswordInput.value;
        });

        // Enable the import button only if the password is filled
        importPasswordInput.addEventListener('input', function () {
            importButton.disabled = !fileInput.files.length || !importPasswordInput.value;
        });

        // Function to log messages
        function logMessage(message) {
            const logEntry = document.createElement('div');
            logEntry.textContent = message;
            logDiv.appendChild(logEntry);
        }

        // Import button click event
        // Import button click event
        importButton.addEventListener('click', async () => {
            const file = fileInput.files[0];
            const importPassword = importPasswordInput.value;

            // Check if file or password is missing and log a message
            if (!file || !importPassword) {
                logMessage('Error: Missing file or password');
                return;
            }

            const reader = new FileReader();

            // Show loading spinner and disable the import button
            loadingDiv.classList.remove('hidden');
            importButton.disabled = true;
            importButton.classList.add('disabled'); // Add extra disabled style if needed

            reader.onload = async function (event) {
                const content = event.target.result;

                try {
                    const response = await fetch('https://app.quizfuze.com/api/import', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ flashcardSets: JSON.parse(content), password: importPassword }),
                    });

                    const result = await response.json(); // Parse the JSON response

                    if (response.success == "true") {
                        logMessage(`Successfully imported: ${result.message || 'Flashcards imported successfully.'}`);
                    } else {
                        logMessage(`Failed to import: ${result.message || response.statusText}`);
                    }
                } catch (error) {
                    logMessage(`Error: ${error.message}`);
                } finally {
                    loadingDiv.classList.add('hidden');
                    importButton.disabled = false;
                    importButton.classList.remove('disabled'); // Re-enable button
                }
            };

            reader.readAsText(file);
        });

    </script>
</body>

</html>